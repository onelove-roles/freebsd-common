---
- name: stop sendmail
  service:
    name: sendmail
    state: stopped

- name: disable sendmail
  template:
    src: sendmail.j2
    dest: /etc/rc.conf.d/sendmail

- name: configure pkg
  template:
    src: FreeBSD.conf.j2
    dest: /etc/pkg/FreeBSD.conf

- name: install packages
  with_items: "{{ common_packages }}"
  pkgng:
    name: "{{ item.name }}"

- name: create certs dir
  file:
    path: /etc/ssl/certs
    state: directory

- name: create private certs dir
  file:
    path: /etc/ssl/private
    mode: 0700
    state: directory

- name: create consul-template config dir
  file:
    path: /usr/local/etc/consul-template.d
    state: directory

- name: create consul-template template dir
  file:
    path: "{{ consul_template_root }}"
    state: directory

- name: enable consul-template
  template:
    src: consul_template.j2
    dest: /etc/rc.conf.d/consul_template
  notify:
    - restart consul-template

- name: configure consul-template
  template:
    src: consul-template.conf.j2
    dest: /usr/local/etc/consul-template.d/consul-template.conf
  notify:
    - restart consul-template
